import{a as y,b as S,c as w,d as b,e as f,f as z}from"./chunk-GDPO7DUK.js";import{a as N,b as R,c as j,f as O}from"./chunk-RMRNQ6AZ.js";import{h as q,n as u,o as B,p as G}from"./chunk-WVZWHAHI.js";import{a as F}from"./chunk-DAPBZYYR.js";import{a as E,b as l}from"./chunk-GTICF4DK.js";import{a as $}from"./chunk-RHYNKE36.js";import{a as P}from"./chunk-2OS3C5NM.js";import{a as K,b as U}from"./chunk-TVWKITRG.js";import{o as x}from"./chunk-6QGFZL3G.js";import{c as D,f as H,g as d,j as h,q as g,r as v}from"./chunk-Q4G5UL72.js";var _=new B(`
:host {
  width: 384px;
  height: 256px;
  display: grid;

  font-family: "Ubuntu", sans-serif;
}

.wrapper {
  display: grid;
  place-content: center;
  gap: 0.5em;
}
`);var C=class c extends EventTarget{constructor(i){super();this.puzzle=i;i.addAlgLeafListener(t=>{let n=t.latestAlgLeaf.as(h);n&&this.dispatchEvent(new CustomEvent("move",{detail:{move:n}}))})}static async connect(){let t=await(await import("./bluetooth-CHRZV6M2.js")).connectSmartPuzzle();return new c(t)}disconnect(){this.puzzle.disconnect()}},T=class c extends EventTarget{constructor(i){super();this.puzzle=i;i.addAlgLeafListener(t=>{let n=t.latestAlgLeaf.as(h);n&&this.dispatchEvent(new CustomEvent("move",{detail:{move:n}}))})}static async connect(){let t=await(await import("./bluetooth-CHRZV6M2.js")).debugKeyboardConnect();return new c(t)}disconnect(){this.puzzle.disconnect()}},k=class extends G{constructor(){super(),this.addCSS(_),this.addElement(document.createElement("span")).textContent="Connect a stream source:";let e=this.addSource("\u{1F4E1} Bluetooth",C);this.addSource("\u2328\uFE0F Keyboard",T),this.addStreamSource(),navigator?.bluetooth||(e.disabled=!0)}addSource(e,i){let t=this.addElement(document.createElement("button"));return t.textContent=e,t.addEventListener("click",async()=>{let n=await i.connect();t.disabled=!0,t.textContent+=" \u2705",n.addEventListener("move",o=>{this.dispatchEvent(new CustomEvent("move",o))})}),t}addStreamSource(){let e="SENTINEL",i=this.addElement(document.createElement("button"));i.textContent="\u{1F534} Get Twizzle streams";let t=this.addElement(document.createElement("select"));t.appendChild(document.createElement("option")).textContent="Streams",t.disabled=!0;let n=null;i.addEventListener("click",async()=>{let o=(await import("./stream-VRVFX2ME.js")).ExperimentalTwizzleStreamServer;n||=new o;let r=await n.streams();t.textContent="",t.disabled=!1;let m=t.appendChild(document.createElement("option"));m.textContent=`Select a stream (${r.length} available)`,m.value=e;for(let s of r){let a=s.senders[0],p=t.appendChild(document.createElement("option"));p.value=s.streamID,p.textContent=`${a.name} (${s.streamID.slice(-2)})`}}),t.addEventListener("change",()=>{let o=t.value;if(o===e)return;n.connect(o).addEventListener("move",m=>{console.log(m),this.dispatchEvent(new CustomEvent("move",m))})})}};u.define("twisty-stream-source",k);var L="(unsupported stickering)";function W(c,e,i){let t=new D;return t.experimentalPushAlg(c),c.experimentalIsEmpty()||Array.from(c.childAlgNodes()).slice(-1)[0].is(d)||t.push(new d),t.push(new H(e)),t.push(new d),t.experimentalPushAlg(i),t.toAlg()}var Q={"3x3x3":"333","2x2x2":"222","4x4x4":"444","5x5x5":"555","6x6x6":"666","7x7x7":"777",clock:"clock",megaminx:"minx",pyraminx:"pyram",skewb:"skewb",square1:"sq1",fto:"fto",master_tetraminx:"master_tetraminx",kilominx:"kilominx",redi_cube:"redi_cube"},V=class{constructor(e,i){this.element=e;this.puzzlePane=E(this.element,"puzzle-pane","puzzle-pane"),this.puzzlePane.classList.remove("loading");let t=this.puzzlePane.querySelector(".spinner");t&&this.puzzlePane.removeChild(t),this.initializeTwisty(i);let n=E(this.element,"control-pane","control-pane");n.classList.remove("loading"),this.controlPane=new I(this,this.twistyPlayer,n,this.solve.bind(this),this.scramble.bind(this)),new j(this.twistyPlayer.experimentalModel)}twistyPlayer;puzzlePane;controlPane;initializeTwisty(e){e.viewerLink="none",this.twistyPlayer=new R(e),this.twistyPlayer.experimentalModel.twistySceneModel.initialHintFaceletsAnimation.set("none"),this.puzzlePane.appendChild(this.twistyPlayer)}async solve(){let[e,i]=await Promise.all([this.twistyPlayer.experimentalModel.puzzleID.get(),this.twistyPlayer.experimentalModel.alg.get()]),t=i.alg,n,o=await x[e].kpuzzle();switch(console.log(o),e){case"2x2x2":{n=await w(o.algToTransformation(t).toKPattern());break}case"3x3x3":{n=await S(o.algToTransformation(t).toKPattern());break}case"skewb":{n=await b(o.algToTransformation(t).toKPattern());break}case"pyraminx":{n=await f(o.algToTransformation(t).toKPattern());break}case"megaminx":{n=await z(o.algToTransformation(t).toKPattern());break}default:return}this.twistyPlayer.alg=W(t," Solution",n)}async scramble(){let[e,i]=await Promise.all([this.twistyPlayer.experimentalModel.puzzleID.get(),this.twistyPlayer.experimentalModel.alg.get()]),t=Q[e];t&&(this.twistyPlayer.alg=W(i.alg," Scramble",await y(t)))}},M=class extends HTMLElement{constructor(){super();for(let e of Array.from(this.querySelectorAll("button")))e.addEventListener("click",this.onClick.bind(this))}onClick(e){this.dispatchEvent(new CustomEvent("action",{detail:{action:e.target.id}}))}setButtonEnabled(e,i){this.querySelector(`#${e}`).disabled=!i}};u.define("button-grid",M);var I=class{constructor(e,i,t,n,o){this.app=e;this.twistyPlayer=i;this.element=t;this.solve=n;this.scramble=o;let r=l(this.element,"title");r.textContent=P,i.experimentalModel.puzzleID.addFreshListener(this.onPuzzle.bind(this)),i.experimentalModel.title.addFreshListener(s=>{r.textContent=s??P}),i.experimentalModel.alg.addFreshListener(({alg:s})=>{let a=F(s);this.caretNISSInfo.hidden=!a.caretNISS,this.commutatorConjugateInfo.hidden=!(a.commutator||a.conjugate);let p=[];a.commutator&&p.push("commutator"),a.conjugate&&p.push("conjugate"),this.commutatorConjugateInfo.querySelector("a").textContent=`${p.join(" and ")} notation`,this.square1Info.hidden=!a.square1}),i.experimentalModel.videoURL.addFreshListener(s=>{let a=document.querySelector(".video-url"),p=s?.toString();a.href=p||"",a.textContent=p?"\u{1F3A5} Video":""}),i.experimentalModel.competitionID.addFreshListener(s=>{let a=document.querySelector(".competition-url");a.href=s?`https://www.worldcubeassociation.org/competitions/${s}`:"",a.textContent=s?"\u{1F3C6} Competition":""}),this.experimentalSetupAlgInput=l(this.element,"experimental-setup-alg","twisty-alg-editor"),this.experimentalSetupAlgInput.twistyPlayer=i,this.moveCountDisplay=l(this.element,"move-count","span"),O(this.twistyPlayer.experimentalModel,this.moveCountDisplay),this.algInput=l(this.element,"alg","twisty-alg-editor"),this.algInput.twistyPlayer=i,this.puzzleSelect=l(this.element,"puzzle","select"),this.twistyPlayer.experimentalModel.puzzleID.get().then(s=>this.initializePuzzleSelect(s)),this.setupAnchorSelect=l(this.element,"setup-anchor","select"),this.twistyPlayer.experimentalModel.setupAnchor.get().then(s=>this.initializeSetupAnchorSelect(s)),this.stickeringSelect=l(this.element,"stickering","select"),new q().addMultiListener([this.twistyPlayer.experimentalModel.twistySceneModel.stickeringRequest,this.twistyPlayer.experimentalModel.puzzleID],([s,a])=>this.updateStickeringSelect(s,a)),this.tempoInput=l(this.element,"tempo","input"),this.tempoDisplay=l(this.element,"tempo-display","span"),this.caretNISSInfo=l(this.element,"caret-niss-info","p"),this.commutatorConjugateInfo=l(this.element,"commutator-conjugate-info","p"),this.square1Info=l(this.element,"square1-info","p"),this.hintFaceletCheckbox=l(this.element,"hint-facelets","input"),this.tempoInput.addEventListener("input",this.onTempoInput.bind(this)),this.hintFaceletCheckbox.addEventListener("input",this.onHintFaceletInput.bind(this)),this.show2DCheckbox=l(this.element,"show-2D","input"),this.show2DCheckbox.addEventListener("input",this.onShow2DInput.bind(this)),this.toolGrid=l(this.element,"tool-grid","button-grid"),this.toolGrid.addEventListener("action",this.onToolAction.bind(this)),this.examplesGrid=l(this.element,"examples-grid","button-grid"),this.examplesGrid.addEventListener("action",this.onExampleAction.bind(this)),this.twistyStreamSource=e.element.querySelector("twisty-stream-source"),this.twistyStreamSource.addEventListener("move",this.onMove.bind(this))}experimentalSetupAlgInput;algInput;moveCountDisplay;puzzleSelect;setupAnchorSelect;stickeringSelect;tempoInput;hintFaceletCheckbox;show2DCheckbox;toolGrid;examplesGrid;tempoDisplay;caretNISSInfo;commutatorConjugateInfo;square1Info;twistyStreamSource;async onMove(e){let i=e.detail.move;try{this.twistyPlayer.experimentalAddMove(i,{cancel:!0})}catch{console.info("Ignoring move:",i.toString())}}onTempoInput(){let e=parseFloat(this.tempoInput.value);this.twistyPlayer.tempoScale=e,this.tempoDisplay.textContent=`${e}\xD7`}onHintFaceletInput(){this.twistyPlayer.hintFacelets=this.hintFaceletCheckbox.checked?"floating":"none"}onShow2DInput(){console.log("this.show2DCheckbox",this.show2DCheckbox),this.twistyPlayer.visualization=this.show2DCheckbox.checked?"2D":"auto"}async onToolAction(e){switch(e.detail.action){case"expand":{this.twistyPlayer.alg=(await this.twistyPlayer.experimentalModel.alg.get()).alg.expand();break}case"simplify":{this.twistyPlayer.experimentalModel.alg.set((async()=>{let[i,t]=await Promise.all([this.twistyPlayer.experimentalModel.alg.get(),this.twistyPlayer.experimentalModel.puzzleLoader.get()]);return i.alg.experimentalSimplify({cancel:!0,puzzleLoader:t})})());break}case"clear":{this.twistyPlayer.alg=new v,this.twistyPlayer.experimentalSetupAlg=new v,this.twistyPlayer.experimentalTitle=null;break}case"invert":{this.twistyPlayer.alg=(await this.twistyPlayer.experimentalModel.alg.get()).alg.invert();break}case"solve":{this.solve();break}case"scramble":{this.scramble();break}case"screenshot":{this.screenshot();break}case"connect-input":{this.connectInput();break}default:throw new Error(`Unknown tool action! ${e.detail.action}`)}}screenshot(){this.app.twistyPlayer.experimentalDownloadScreenshot()}connectInput(){this.twistyStreamSource.style.setProperty("display","inherit")}onExampleAction(e){let i=$[e.detail.action];this.twistyPlayer.alg=g(i.alg),this.twistyPlayer.experimentalSetupAlg=g(i.experimentalSetupAlg),this.twistyPlayer.experimentalTitle=i.experimentalTitle??null}initializePuzzleSelect(e){this.puzzleSelect.textContent="";for(let[i,t]of Object.entries(K)){let n=this.puzzleSelect.appendChild(document.createElement("optgroup"));n.label=i;for(let o of t){let r=document.createElement("option");r.value=o.name,r.textContent=`${o.symbol} ${U[o.name].displayName()}`,n.appendChild(r),o.name===e&&(r.selected=!0)}}this.puzzleSelect.addEventListener("change",this.puzzleSelectChanged.bind(this))}puzzleSelectChanged(){let e=this.puzzleSelect.selectedOptions[0];this.twistyPlayer.puzzle=e.value}initializeSetupAnchorSelect(e){this.setupAnchorSelect.textContent="";for(let i of["start","end"]){let t=document.createElement("option");t.value=i,t.textContent=`anchored at ${i}`,this.setupAnchorSelect.appendChild(t),i===e&&(t.selected=!0)}this.setupAnchorSelect.addEventListener("change",this.setupAnchorSelectChanged.bind(this))}setupAnchorSelectChanged(){let e=this.setupAnchorSelect.selectedOptions[0];this.twistyPlayer.experimentalSetupAnchor=e.value}async updateStickeringSelect(e,i){e??="full";let t,n=x[i];if(n.stickerings){t={};for(let r of await n.stickerings())t[r]={}}else t={full:{}};e in t||(t[L]={},e=L),this.stickeringSelect.textContent="";let o=null;for(let[r,m]of Object.entries(t)){let s=r===L?"Unsupported":N(r,i);(!o||o.label!==s)&&(o=this.stickeringSelect.appendChild(document.createElement("optgroup")),o.label=s);let a=document.createElement("option");a.value=r,a.textContent=m?.name??r,o.appendChild(a),r===e&&(a.selected=!0)}this.stickeringSelect.addEventListener("change",this.stickeringChanged.bind(this))}stickeringChanged(){this.twistyPlayer.experimentalStickering=this.stickeringSelect.selectedOptions[0].value}onPuzzle(e){this.hintFaceletCheckbox.disabled=["clock","square1","redi_cube","melindas2x2x2x2"].includes(e),this.toolGrid.setButtonEnabled("solve",["2x2x2","3x3x3","skewb","pyraminx","megaminx"].includes(e)),this.toolGrid.setButtonEnabled("scramble",Object.keys(Q).includes(e))}},J=[],A=class extends HTMLElement{associatedElem=null;expanded;expandIcon;exclusive;connectedCallback(){let e=this.getAttribute("for");this.associatedElem=e?document.getElementById(e):null,this.expandIcon=this.querySelector(".expand-icon"),this.querySelector("a").addEventListener("click",this.onClick.bind(this)),this.expanded=this.getAttribute("expanded")==="true",this.exclusive=this.getAttribute("exclusive")!=="false",this.exclusive&&J.push(this)}onClick(e){if(e.preventDefault(),this.toggle(),this.exclusive&&this.expanded)for(let i of J)i!==this&&i.toggle(!1)}toggle(e){this.expanded=e??!this.expanded,this.associatedElem&&(this.associatedElem.hidden=!this.expanded),this.expandIcon.textContent=this.exclusive?this.expanded?"\u25BF":"\u25B9":this.expanded?"\u25BE":"\u25B8"}};u.define("expand-button",A);export{V as a};
//# sourceMappingURL=chunk-DQF3AEWB.js.map
